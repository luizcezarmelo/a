<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kit do Técnico — Comandos Windows (Online/Firebase)</title>
    <style>
        :root{
            --bg:#0f1720;
            --card:#0b1220;
            --muted:#9aa6b2;
            --accent:#0ea5a4;
            --accent-2:#7dd3fc;
            --surface:#0b1226;
            --glass: rgba(255,255,255,0.03);
            --success:#16a34a;
            --danger: #ef4444;
            --highlight: rgba(14, 165, 164, 0.1);
        }
        *{box-sizing:border-box;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif}
        body{margin:0;background:linear-gradient(180deg,#071024 0%, #071a2b 100%);color:#e6eef6}
        .app{display:flex;min-height:100vh}
        aside{
            width:300px;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-right:1px solid rgba(255,255,255,0.03);padding:20px;backdrop-filter: blur(6px);
            max-height: 100vh;
            overflow-y: auto;
        }
        header.brand{display:flex;align-items:center;gap:12px;margin-bottom:18px}
        .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#012;}
        h1{font-size:16px;margin:0}
        p.sub{margin:4px 0 0;font-size:12px;color:var(--muted)}
        nav{margin-top:18px}
        .cat{display:block;padding:10px;border-radius:8px;color:var(--muted);text-decoration:none;margin-bottom:6px}
        .cat:hover{background:var(--glass);color:#fff}
        .cat.active{background:linear-gradient(90deg,var(--accent-2),var(--accent));color:#012;font-weight:600}
        main{flex:1;padding:22px}
        .top{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
        .search{
            background:var(--surface);padding:8px;border-radius:10px;display:flex;align-items:center;gap:8px;
            border:1px solid rgba(255,255,255,0.04);flex:1;min-width:260px;
            max-width: 450px;
        }
        .search input{background:transparent;border:0;outline:0;color:#e6eef6;font-size:14px;padding:8px;width:100%}
        .search .clear{background:transparent;border:0;color:var(--muted);cursor:pointer;padding:6px;border-radius:6px}
        .info{font-size:13px;color:var(--muted)}
        .grid{margin-top:18px;display:grid;grid-template-columns: 1fr 380px;gap:18px}
        .list{
            background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:12px;
            border-radius:12px;border:1px solid rgba(255,255,255,0.02);max-height:72vh;overflow:auto
        }
        
        /* --- ESTILOS DA ÁRVORE --- */
        details {
            background:linear-gradient(180deg, rgba(255,255,255,0.008), transparent);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        details[open] {
            background:rgba(255,255,255,0.015);
        }
        summary {
            list-style: none;
            display: block;
        }
        summary::-webkit-details-marker { display: none; }
        summary:focus {
            outline: 1px dashed var(--accent);
            outline-offset: 2px;
        }
        .card{
            display:flex;align-items:center;justify-content:space-between;padding:10px;
            border-radius:8px;
            background:transparent;
            transition: background .2s;
        }
        summary .card:hover {
            background:rgba(255,255,255,0.02);
        }
        .card-parent {
            cursor: pointer;
        }
        .card-parent .cmd::before {
            content: '▸';
            color: var(--accent-2);
            margin-right: 8px;
            display: inline-block;
            transition: transform 0.2s;
        }
        details[open] .card-parent .cmd::before {
            transform: rotate(90deg);
        }
        .sub-list {
            padding-left: 32px;
            border-left: 2px solid var(--surface);
            margin: 0 0 8px 18px;
        }
        .sub-list .card {
            margin-bottom: 6px;
            background: rgba(0,0,0,0.1);
        }
        .sub-list .card:hover {
            background: rgba(0,0,0,0.2);
        }
        .card.highlight-search {
            background: var(--highlight) !important;
            box-shadow: inset 2px 0 0 var(--accent);
        }
        /* --- FIM ESTILOS ÁRVORE --- */
        
        .cmd{font-family:Consolas,monospace;background:rgba(0,0,0,0.25);padding:6px 8px;border-radius:6px;font-size:13px}
        .meta{color:var(--muted);font-size:13px;margin-left:10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        
        .card-left {
            display: flex;
            align-items: center;
            min-width: 0; /* (Importante para text-overflow) */
            cursor: pointer;
            flex: 1;
        }
        .card-right {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
            padding-left: 10px;
        }
        
        .btncopy{
            background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:8px;
            color:var(--accent-2);cursor:pointer;font-weight:600;
        }
        
        /* (NOVO) Botões de ação */
        .btn-action {
            background: transparent;
            border: 0;
            color: var(--muted);
            cursor: pointer;
            font-size: 11px;
            padding: 4px;
            border-radius: 4px;
        }
        .btn-action:hover {
            background: var(--surface);
        }
        .btn-edit:hover {
            color: var(--accent-2);
        }
        .btn-delete:hover {
            color: var(--danger);
        }
        /* (NOVO) Estilo para o botão Substituir */
        .btn-override:hover {
            color: var(--accent);
        }
        
        .sidepanel{background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);max-height:72vh;overflow:auto}
        .sidepanel h3{margin:0 0 8px 0;font-size:14px}
        .group{margin-bottom:12px}
        .small{font-size:13px;color:var(--muted);margin-top:6px}
        
        .toast{position:fixed;right:22px;bottom:22px;background:linear-gradient(90deg,var(--success),#10b981);padding:10px 14px;border-radius:10px;color:#022;box-shadow:0 6px 24px rgba(2,6,23,0.6);transform:translateY(8px);opacity:0;pointer-events:none;transition:all .28s}
        .toast.show{opacity:1;transform:translateY(0);pointer-events:auto}
        
        .tag{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.02);color:var(--muted);border:1px solid rgba(255,255,255,0.02);margin-right:8px}
        footer.foot{margin-top:12px;color:var(--muted);font-size:13px}
        
        .form-group { margin-bottom: 10px; }
        .form-group label {
            display: block;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 4px;
        }
        .form-input, .form-select {
            width: 100%;
            background: var(--surface);
            border: 1px solid rgba(255,255,255,0.04);
            color: #e6eef6;
            padding: 8px;
            border-radius: 6px;
            font-size: 13px;
        }
        /* (NOVO) Estilo para campo 'cmd' bloqueado ao substituir */
        .form-input[readonly] {
            background: rgba(0,0,0,0.2);
            color: var(--muted);
            cursor: not-allowed;
        }

        .form-input::placeholder {
            color: var(--muted);
            opacity: 0.6;
        }
        .form-btn {
            width: 100%;
            padding: 10px;
            border: 0;
            border-radius: 6px;
            background: var(--accent);
            color: #012;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        .form-btn:hover { background: var(--accent-2); }
        .form-btn:disabled {
            background: var(--muted);
            cursor: not-allowed;
        }
        .form-btn-danger { background: var(--danger); color: #fff; }
        .form-btn-danger:hover { background: #f87171; }
        .form-btn-secondary {
            background: var(--surface);
            color: var(--muted);
        }
        .form-btn-secondary:hover {
            background: var(--glass);
            color: #fff;
        }
        
        /* (NOVO) Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: none; /* Alterado para 'flex' via JS */
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: var(--bg);
            border: 1px solid var(--surface);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-content h3 {
            margin: 0 0 16px 0;
            font-size: 16px;
        }
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        @media (max-width:900px){
            aside{display:none}
            .grid{grid-template-columns:1fr}
            .sidepanel{order:2}
        }
    </style>
</head>
<body>
    <div class="app" role="application" aria-label="Kit do Técnico — comandos">
        <aside>
            <div class="brand">
                <div class="logo">TK</div>
                <div>
                    <h1>Kit do Técnico</h1>
                    <p class="sub">Comandos WR / DOS / PowerShell — Online</p>
                </div>
            </div>
            
            <nav aria-label="Categorias">
                <a class="cat active" data-cat="Todas" href="#" onclick="return false;">Todas</a>
                <a class="cat" data-cat="Sistema" href="#" onclick="return false;">Sistema</a>
                <a class="cat" data-cat="Hardware" href="#" onclick="return false;">Hardware</a>
                <a class="cat" data-cat="Disco & Arquivos" href="#" onclick="return false;">Disco & Arquivos</a>
                <a class="cat" data-cat="Rede" href="#" onclick="return false;">Rede</a>
                <a class="cat" data-cat="Serviços & Processos" href="#" onclick="return false;">Serviços & Processos</a>
                <a class="cat" data-cat="Usuário & Grupo" href="#" onclick="return false;">Usuário & Grupo</a>
                <a class="cat" data-cat="Logs & Diagnóstico" href="#" onclick="return false;">Logs & Diagnóstico</a>
                <a class="cat" data-cat="Política & GPO" href="#" onclick="return false;">Política & GPO</a>
                <a class="cat" data-cat="Boot & BCD" href="#" onclick="return false;">Boot & BCD</a>
                <a class="cat" data-cat="PowerShell" href="#" onclick="return false;">PowerShell</a>
                <a class="cat" data-cat="Utilitários GUI" href="#" onclick="return false;">Utilitários (MSC)</a>
                <a class="cat" data-cat="Segurança" href="#" onclick="return false;">Segurança</a>
            </nav>
            
            <footer class="foot">
                <div style="margin-top:12px">Arquivo único — clique para copiar</div>
                <div class="small">Sincronizado com Firebase RTDB.</div>
            </footer>
        </aside>

        <main>
            <div class="top">
                <div class="search" role="search" aria-label="Pesquisar comandos">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.7"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <input id="q" placeholder="Pesquisar (comando ou descrição) — digite 3+ letras..." aria-label="Pesquisar comandos" />
                    <button class="clear" id="clearBtn" title="Limpar pesquisa" aria-label="Limpar pesquisa">✕</button>
                </div>
                <div class="info">Clique no comando para copiar</div>
            </div>

            <div class="grid">
                <div class="list" id="results" tabindex="0" aria-live="polite">
                    </div>

                <aside class="sidepanel" aria-label="Detalhes">
                    <h3>Filtros & Dicas</h3>
                    <div class="small">Clique nas categorias à esquerda para filtrar. A pesquisa busca por comando e descrição (case-insensitive). Pesquisa ativa apenas com 3+ caracteres.</div>
                    
                    <div class="group">
                        <h3 style="margin-top:12px">Atalhos úteis</h3>
                        <div class="small">
                            <div style="margin-top:8px"><span class="tag">WR</span> abrir via Executar (Win + R)</div>
                            <div style="margin-top:6px"><span class="tag">DOS</span> prompt (cmd.exe) — executar como Administrador quando necessário</div>
                            <div style="margin-top:6px"><span class="tag">PowerShell</span> cmdlets do PowerShell moderno</div>
                        </div>
                    </div>

                    <div class="group" style="margin-top: 16px;">
                        <h3>Adicionar Novo Comando</h3>
                        <div class="small" style="margin-bottom: 10px;">Comandos salvos online (Firebase).</div>
                        <form id="addCommandForm">
                            <div class="form-group">
                                <label for="new_cmd">Comando (Pai)</label>
                                <input type="text" id="new_cmd" class="form-input" placeholder="ex: sfc /scannow" required>
                            </div>
                            <div class="form-group">
                                <label for="new_type">Tipo</label>
                                <select id="new_type" class="form-select" required>
                                    <option value="DOS">DOS</option>
                                    <option value="WR">WR</option>
                                    <option value="PowerShell">PowerShell</option>
                                    <option value="Utilitários GUI">Utilitários GUI</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="new_cat">Categoria</label>
                                <select id="new_cat" class="form-select" required>
                                    </select>
                            </div>
                            <div class="form-group">
                                <label for="new_desc">Descrição (Resumo)</label>
                                <input type="text" id="new_desc" class="form-input" placeholder="ex: Verifica arquivos do sistema" required>
                            </div>
                            <button type="submit" class="form-btn" id="addBtn">Adicionar Comando</button>
                            <button type="button" class="form-btn form-btn-secondary" id="cancelOverrideBtn" style="display: none; margin-top: 8px;">Cancelar Substituição</button>
                        </form>
                    </div>

                </aside>
            </div>
        </main>
    </div>

    <div id="toast" class="toast" role="status" aria-live="polite">Copiado</div>
    
    <div class="modal-overlay" id="editModal">
        <div class="modal-content">
            <h3>Editar Comando</h3>
            <form id="editCommandForm">
                <input type="hidden" id="edit_id">
                <div class="form-group">
                    <label for="edit_cmd">Comando</label>
                    <input type="text" id="edit_cmd" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="edit_type">Tipo</label>
                    <select id="edit_type" class="form-select" required>
                        <option value="DOS">DOS</option>
                        <option value="WR">WR</option>
                        <option value="PowerShell">PowerShell</option>
                        <option value="Utilitários GUI">Utilitários GUI</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit_cat">Categoria</label>
                    <select id="edit_cat" class="form-select" required>
                         </select>
                </div>
                <div class="form-group">
                    <label for="edit_desc">Descrição (Resumo)</label>
                    <input type="text" id="edit_desc" class="form-input" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="form-btn form-btn-secondary" id="editCancelBtn">Cancelar</button>
                    <button type="submit" class="form-btn" id="editSaveBtn">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

<script type="module">
    // Importe as funções do Firebase (update, remove)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, set, update, remove } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    // Sua configuração do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDQOGFiqafMZh0ha6XW62P1DpIKJE8TBYc",
        authDomain: "agenda-online-7b71c.firebaseapp.com",
        databaseURL: "https://agenda-online-7b71c-default-rtdb.firebaseio.com",
        projectId: "agenda-online-7b71c",
        storageBucket: "agenda-online-7b71c.firebasestorage.app",
        messagingSenderId: "28125733214",
        appId: "1:28125733214:web:162d1cce5d14f55c24afcf"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'techkit/commands');

    /* Lista de comandos BASE (igual) */
    const baseCommands = [
        // Sistema / Informações
        {cmd:"winver", type:"WR", desc:"Mostra versão do Windows (janela 'Sobre')", cat:"Sistema"},
        {cmd:"msinfo32", type:"WR", desc:"Informações detalhadas do sistema (System Information)", cat:"Sistema"},
        {cmd:"systeminfo", type:"DOS", desc:"Resumo do sistema (linha de comando)", cat:"Sistema"},
        {cmd:"hostname", type:"DOS", desc:"Mostra o nome do computador", cat:"Sistema"},
        {cmd:"set", type:"DOS", desc:"Mostra variáveis de ambiente", cat:"Sistema"},
        {cmd:"echo %username%", type:"DOS", desc:"Mostra usuário atual (CMD)", cat:"Sistema"},
        {cmd:"control /name Microsoft.System", type:"WR", desc:"Abre a janela clássica Sistema no Painel de Controle", cat:"Sistema"},
        {cmd:"ms-settings:about", type:"WR", desc:"Abre Configurações → Sobre", cat:"Sistema"},
        
        // Usuário / Grupo / Políticas
        { cmd:"net user", type:"DOS", desc:"Gerencia contas de usuário", cat:"Usuário & Grupo", sub: [
            {cmd:"net user", type:"DOS", desc:"Lista todos os usuários locais", cat:"Usuário & Grupo"},
            {cmd:"net user [username]", type:"DOS", desc:"Mostra detalhes de um usuário", cat:"Usuário & Grupo"},
            {cmd:"net user [username] *", type:"DOS", desc:"Solicita nova senha para usuário", cat:"Usuário & Grupo"},
            {cmd:"net user [username] /add", type:"DOS", desc:"Adiciona novo usuário (sem senha)", cat:"Usuário & Grupo"},
            {cmd:"net user [username] [senha] /add", type:"DOS", desc:"Adiciona novo usuário com senha", cat:"Usuário & Grupo"},
            {cmd:"net user [username] /delete", type:"DOS", desc:"Remove um usuário", cat:"Usuário & Grupo"},
            {cmd:"net user [username] /active:yes", type:"DOS", desc:"Ativa conta de usuário", cat:"Usuário & Grupo"},
            {cmd:"net user [username] /active:no", type:"DOS", desc:"Desativa conta de usuário", cat:"Usuário & Grupo"}
        ]},
        {cmd:"net localgroup Administradores", type:"DOS", desc:"Lista membros do grupo Administradores local", cat:"Usuário & Grupo"},
        {cmd:"whoami", type:"DOS", desc:"Mostra usuário atual (inclui SID)", cat:"Usuário & Grupo"},
        {cmd:"gpupdate /force", type:"DOS", desc:"Força atualização de GPO (Group Policy)", cat:"Política & GPO"},
        {cmd:"gpresult /r", type:"DOS", desc:"Mostra RSoP / GPO aplicada no computador/usuário", cat:"Política & GPO"},
        {cmd:"secedit /refreshpolicy machine_policy /enforce", type:"DOS", desc:"Reaplica políticas de segurança (legacy)", cat:"Política & GPO"},
        
        // GUI / MMC / Ferramentas WR (Win+R)
        {cmd:"devmgmt.msc", type:"WR", desc:"Gerenciador de Dispositivos", cat:"Utilitários GUI"},
        {cmd:"eventvwr.msc", type:"WR", desc:"Visualizador de Eventos (Event Viewer)", cat:"Utilitários GUI"},
        {cmd:"services.msc", type:"WR", desc:"Serviços (gerenciar serviços do sistema)", cat:"Utilitários GUI"},
        {cmd:"compmgmt.msc", type:"WR", desc:"Gerenciamento do Computador (console composto)", cat:"Utilitários GUI"},
        {cmd:"diskmgmt.msc", type:"WR", desc:"Gerenciamento de Disco (Disk Management)", cat:"Utilitários GUI"},
        {cmd:"perfmon", type:"WR", desc:"Monitor de Desempenho (Performance Monitor)", cat:"Utilitários GUI"},
        {cmd:"taskschd.msc", type:"WR", desc:"Agendador de Taretas (Task Scheduler)", cat:"Utilitários GUI"},
        {cmd:"rsop.msc", type:"WR", desc:"RSoP (Resultant Set of Policy) MMC", cat:"Utilitários GUI"},
        {cmd:"certlm.msc", type:"WR", desc:"Gerenciador de certificados (computador local)", cat:"Utilitários GUI"},
        
        // Disco & Arquivos
        {cmd:"chkdsk C: /f /r", type:"DOS", desc:"Verifica/soluciona erros no disco (pode exigir reinício)", cat:"Disco & Arquivos"},
        {cmd:"sfc /scannow", type:"DOS", desc:"Verifica e repara arquivos protegidos do sistema", cat:"Disco & Arquivos"},
        {cmd:"dism /online /cleanup-image /restorehealth", type:"DOS", desc:"Repara imagem do Windows (útil após SFC)", cat:"Disco & Arquivos"},
        { cmd:"diskpart", type:"DOS", desc:"Utilitário de partição (interativo)", cat:"Disco & Arquivos", sub: [
            {cmd:"list disk", type:"DOS", desc:"Lista discos físicos", cat:"Disco & Arquivos"},
            {cmd:"select disk [n]", type:"DOS", desc:"Seleciona o disco 'n'", cat:"Disco & Arquivos"},
            {cmd:"list partition", type:"DOS", desc:"Lista partições no disco selecionado", cat:"Disco & Arquivos"},
            {cmd:"list volume", type:"DOS", desc:"Lista volumes (letras)", cat:"Disco & Arquivos"},
            {cmd:"clean", type:"DOS", desc:"Limpa (apaga) o disco selecionado", cat:"Disco & Arquivos"},
            {cmd:"create partition primary", type:"DOS", desc:"Cria partição primária", cat:"Disco & Arquivos"},
            {cmd:"format fs=ntfs quick", type:"DOS", desc:"Formata partição selecionada", cat:"Disco & Arquivos"},
            {cmd:"assign letter=X", type:"DOS", desc:"Atribui letra X à partição", cat:"Disco & Arquivos"}
        ]},
        {cmd:"format X: /FS:NTFS", type:"DOS", desc:"Formata a unidade X (atenção: apaga dados)", cat:"Disco & Arquivos"},
        {cmd:"mountvol", type:"DOS", desc:"Gerencia pontos de montagem/volumes", cat:"Disco & Arquivos"},
        {cmd:"robocopy <src> <dst> /MIR /Z /R:3 /W:5", type:"DOS", desc:"Cópia robusta de arquivos (Robocopy) — exemplo com espelhamento", cat:"Disco & Arquivos"},
        {cmd:"fsutil fsinfo volumes", type:"DOS", desc:"Informações de volumes/FS", cat:"Disco & Arquivos"},

        // Hardware / Drivers
        {cmd:"pnputil /enum-drivers", type:"DOS", desc:"Lista drivers instalados", cat:"Hardware"},
        {cmd:"pnputil /add-driver <inf> /install", type:"DOS", desc:"Instala driver a partir de .inf", cat:"Hardware"},
        {cmd:"driverquery", type:"DOS", desc:"Lista drivers instalados e status", cat:"Hardware"},
        {cmd:"wmic csproduct get name,identifyingnumber", type:"DOS", desc:"Mostra modelo e serial do produto (quando disponível)", cat:"Hardware"},
        {cmd:"wmic bios get serialnumber", type:"DOS", desc:"Retorna serial do BIOS/placa-mãe", cat:"Hardware"},

        // Rede — básicos
        {cmd:"ipconfig", type:"DOS", desc:"Mostra configurações IP", cat:"Rede"},
        {cmd:"ipconfig /all", type:"DOS", desc:"Mostra informações IP completas (inclui DNS, MAC)", cat:"Rede"},
        {cmd:"ipconfig /release && ipconfig /renew", type:"DOS", desc:"Libera e renova endereço DHCP", cat:"Rede"},
        {cmd:"ipconfig /flushdns", type:"DOS", desc:"Limpa cache DNS", cat:"Rede"},
        {cmd:"ping 8.8.8.8", type:"DOS", desc:"Testa conectividade IP básica (ex.: Google DNS)", cat:"Rede"},
        {cmd:"ping hostname", type:"DOS", desc:"Resolve nome e testa latência para hostname", cat:"Rede"},
        {cmd:"tracert hostname", type:"DOS", desc:"Rastreia rota até host (traceroute)", cat:"Rede"},
        {cmd:"pathping hostname", type:"DOS", desc:"Combina ping e tracert com estatísticas", cat:"Rede"},
        { cmd:"nslookup", type:"DOS", desc:"Consulta DNS (interativo)", cat:"Rede", sub: [
            {cmd:"nslookup [domain]", type:"DOS", desc:"Resolve IP de um domínio", cat:"Rede"},
            {cmd:"server 8.8.8.8", type:"DOS", desc:"(Dentro do nslookup) Muda servidor DNS", cat:"Rede"},
            {cmd:"set type=mx", type:"DOS", desc:"(Dentro do nslookup) Define tipo de registro (ex: MX, A, CNAME)", cat:"Rede"}
        ]},
        {cmd:"netstat -ano", type:"DOS", desc:"Mostra conexões de rede e portas (PID incluído)", cat:"Rede"},
        {cmd:"arp -a", type:"DOS", desc:"Tabela ARP (IP ↔ MAC)", cat:"Rede"},
        {cmd:"route print", type:"DOS", desc:"Tabela de rotas IP", cat:"Rede"},
        {cmd:"netsh interface ip show config", type:"DOS", desc:"Configurações IP via netsh", cat:"Rede"},
        {cmd:"netsh wlan show profiles", type:"DOS", desc:"Lista perfis WLAN salvos", cat:"Rede"},
        {cmd:"netsh wlan show profile name=\"<perfil>\" key=clear", type:"DOS", desc:"Mostra senha de perfil Wi-Fi (administrador)", cat:"Rede"},

        // Rede — avançado / interface
        {cmd:"netsh interface reset all", type:"DOS", desc:"Reseta configurações de rede (útil para problemas)", cat:"Rede"},
        {cmd:"netsh int ip reset", type:"DOS", desc:"Reseta stack TCP/IP", cat:"Rede"},
        {cmd:"Get-NetIPAddress", type:"PowerShell", desc:"Lista endereços IP (PowerShell - NetTCPIP)", cat:"PowerShell"},
        {cmd:"Get-NetAdapter", type:"PowerShell", desc:"Lista adaptadores de rede (PowerShell)", cat:"PowerShell"},
        {cmd:"Test-Connection -ComputerName 8.8.8.8 -Count 4", type:"PowerShell", desc:"Ping em PowerShell (Test-Connection)", cat:"PowerShell"},
        
        // Serviços e processos
        {cmd:"tasklist", type:"DOS", desc:"Lista processos em execução", cat:"Serviços & Processos"},
        {cmd:"taskkill /PID 1234 /F", type:"DOS", desc:"Finaliza processo por PID", cat:"Serviços & Processos"},
        { cmd:"sc", type:"DOS", desc:"Gerencia serviços (SC)", cat:"Serviços & Processos", sub: [
            {cmd:"sc query", type:"DOS", desc:"Lista status de todos os serviços", cat:"Serviços & Processos"},
            {cmd:"sc query [servicename]", type:"DOS", desc:"Mostra status de um serviço", cat:"Serviços & Processos"},
            {cmd:"sc queryex [servicename]", type:"DOS", desc:"Mostra detalhes (inclui PID) de um serviço", cat:"Serviços & Processos"},
            {cmd:"sc start [servicename]", type:"DOS", desc:"Inicia um serviço", cat:"Serviços & Processos"},
            {cmd:"sc stop [servicename]", type:"DOS", desc:"Para um serviço", cat:"Serviços & Processos"},
            {cmd:"sc config [servicename] start=auto", type:"DOS", desc:"Muda inicialização para Automático", cat:"Serviços & Processos"},
            {cmd:"sc config [servicename] start=demand", type:"DOS", desc:"Muda inicialização para Manual", cat:"Serviços & ProcessOS"},
            {cmd:"sc config [servicename] start=disabled", type:"DOS", desc:"Desativa o serviço", cat:"Serviços & Processos"}
        ]},
        {cmd:"powershell Get-Process", type:"PowerShell", desc:"Lista processos (PowerShell)", cat:"PowerShell"},
        {cmd:"powershell Get-Service", type:"PowerShell", desc:"Lista serviços (PowerShell)", cat:"PowerShell"},

        // Logs & Diagnóstico
        {cmd:"wevtutil qe System /c:10 /f:text", type:"DOS", desc:"Consulta últimos 10 eventos do log System via linha de comando", cat:"Logs & Diagnóstico"},
        {cmd:"Get-WinEvent -LogName System -MaxEvents 20", type:"PowerShell", desc:"Puxa últimos eventos do log System (PowerShell)", cat:"PowerShell"},
        {cmd:"perfmon /report", type:"WR", desc:"Gera relatório de desempenho de sistema", cat:"Logs & Diagnóstico"},
        {cmd:"resmon", type:"WR", desc:"Monitor de Recursos (Resource Monitor)", cat:"Logs & Diagnóstico"},

        // Boot / BCD / Recuperação
        {cmd:"bcdedit", type:"DOS", desc:"Mostra/edita BCD (boot configuration data) — use com cuidado", cat:"Boot & BCD"},
        {cmd:"bcdedit /export C:\\bcdbackup", type:"DOS", desc:"Exporta BCD para backup", cat:"Boot & BCD"},
        {cmd:"bootrec /fixmbr", type:"DOS", desc:"Repara MBR (uso em Ambiente de Recuperação)", cat:"Boot & BCD"},
        {cmd:"bootrec /fixboot", type:"DOS", desc:"Regrava setor de boot (recuperação)", cat:"Boot & BCD"},
        {cmd:"bootrec /rebuildbcd", type:"DOS", desc:"Reconstrói BCD (recuperação)", cat:"Boot & BCD"},

        // Windows Update / Patches
        {cmd:"wuauclt /detectnow", type:"DOS", desc:"Força verificação de atualização (legacy)", cat:"Sistema"},
        {cmd:"usoclient StartScan", type:"DOS", desc:"Aciona verificação de atualização no Windows 10/11 (pode exigir privilégios)", cat:"Sistema"},
        {cmd:"Get-WindowsUpdateLog", type:"PowerShell", desc:"Gera log consolidado de Windows Update", cat:"PowerShell"},
        {cmd:"Get-HotFix", type:"PowerShell", desc:"Lista hotfixes/patches instalados", cat:"PowerShell"},

        // Licença / Ativação
        {cmd:"slmgr /xpr", type:"DOS", desc:"Mostra estado de ativação do Windows", cat:"Sistema"},
        {cmd:"slmgr /ipk <chave>", type:"DOS", desc:"Instala chave de produto", cat:"Sistema"},
        {cmd:"slmgr /ato", type:"DOS", desc:"Força ativação online", cat:"Sistema"},

        // Admin remota / RDP / Firewall
        {cmd:"mstsc", type:"WR", desc:"Conexão da Área de Trabalho Remota (mstsc.exe)", cat:"Rede"},
        {cmd:"netsh advfirewall firewall show rule name=all", type:"DOS", desc:"Lista regras de firewall", cat:"Rede"},
        {cmd:"netsh advfirewall set allprofiles state off", type:"DOS", desc:"Desativa firewall (não recomendado em produção)", cat:"Rede"},
        {cmd:"powershell Enable-PSRemoting -Force", type:"PowerShell", desc:"Ativa PowerShell Remoting (WinRM)", cat:"PowerShell"},
        
        // Utilitários gerais
        {cmd:"cmd", type:"WR", desc:"Abre Prompt de Comando", cat:"Utilitários GUI"},
        {cmd:"powershell", type:"WR", desc:"Abre PowerShell", cat:"PowerShell"},
        {cmd:"powershell Start-Process powershell -Verb runAs", type:"PowerShell", desc:"Abre PowerShell elevado (Admin)", cat:"PowerShell"},
        {cmd:"taskmgr", type:"WR", desc:"Abre Gerenciador de Tarefas", cat:"Utilitários GUI"},
        {cmd:"control", type:"WR", desc:"Abre Painel de Controle", cat:"Utilitários GUI"},

        // Segurança / EDR / Antivirus
        {cmd:"sc queryex Windefend", type:"DOS", desc:"Verifica serviço do Windows Defender", cat:"Segurança"},
        { cmd:"mpcmdrun", type:"DOS", desc:"Utilitário Defender (executar de 'Program Files\\...)", cat:"Segurança", sub: [
            {cmd:"MpCmdRun -Scan -ScanType 2", type:"DOS", desc:"Inicia scan completo do Defender", cat:"Segurança"},
            {cmd:"MpCmdRun -SignatureUpdate", type:"DOS", desc:"Força atualização de definições", cat:"Segurança"},
            {cmd:"MpCmdRun -RemoveDefinitions", type:"DOS", desc:"Remove definições (rollback)", cat:"Segurança"}
        ]},

        // Vários / Ajuda
        {cmd:"help", type:"DOS", desc:"Ajuda básica no CMD", cat:"Utilitários GUI"},
        {cmd:"getmac", type:"DOS", desc:"Mostra endereços MAC das interfaces", cat:"Rede"},
        {cmd:"wmic logicaldisk get name,size,freespace,filesystem", type:"DOS", desc:"Informações de discos e espaço", cat:"Disco & Arquivos"}
    ];
    

    // --- LÓGICA DE UI E FIREBASE --- //
    
    // Variáveis globais
    const resultsEl = document.getElementById('results');
    const qEl = document.getElementById('q');
    const clearBtn = document.getElementById('clearBtn');
    const toast = document.getElementById('toast');
    const cats = Array.from(document.querySelectorAll('.cat'));
    
    const addForm = document.getElementById('addCommandForm');
    const addBtn = document.getElementById('addBtn');
    const newCatSelect = document.getElementById('new_cat');
    const newCmdInput = document.getElementById('new_cmd');
    const cancelOverrideBtn = document.getElementById('cancelOverrideBtn');
    
    // (NOVO)
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editCommandForm');
    const editCancelBtn = document.getElementById('editCancelBtn');
    const editCatSelect = document.getElementById('edit_cat');
    
    const editIdInput = document.getElementById('edit_id');
    const editCmdInput = document.getElementById('edit_cmd');
    const editTypeInput = document.getElementById('edit_type');
    const editDescInput = document.getElementById('edit_desc');

    let activeCategory = "Todas";
    let customCommands = []; // APENAS comandos do Firebase
    let commands = []; // Lista mesclada (Base + Custom)

    
    /**
     * Cria um card (linha de comando)
     * (*** ALTERADO PARA ADICIONAR BOTÃO "SUBSTITUIR" ***)
     */
    function renderCard(it, isSubItem = false) {
        const card = document.createElement('div');
        card.className = 'card';

        const left = document.createElement('div');
        left.className = 'card-left';

        const cmdSpan = document.createElement('div');
        cmdSpan.className = 'cmd';
        cmdSpan.textContent = it.cmd;

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `<span style="font-weight:600">${it.type}</span> — ${it.desc}`;

        left.appendChild(cmdSpan);
        left.appendChild(meta);
        left.onclick = (ev) => {
            copyCommand(it.cmd);
        };

        const right = document.createElement('div');
        right.className = 'card-right';

        // Botões de Ação
        if (it.id && !isSubItem) { // É um comando CUSTOM (do Firebase)
            const editBtn = document.createElement('button');
            editBtn.className = 'btn-action btn-edit';
            editBtn.textContent = 'Editar';
            editBtn.setAttribute('aria-label', `Editar comando: ${it.cmd}`);
            editBtn.onclick = (e) => {
                e.stopPropagation();
                handleShowEditModal(it);
            };

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn-action btn-delete';
            deleteBtn.textContent = 'Excluir';
            deleteBtn.setAttribute('aria-label', `Excluir comando: ${it.cmd}`);
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                handleDeleteCommand(it);
            };

            right.appendChild(editBtn);
            right.appendChild(deleteBtn);
            
        } else if (!it.id && !isSubItem) { // (NOVO) É um comando BASE (do código)
            const overrideBtn = document.createElement('button');
            overrideBtn.className = 'btn-action btn-override';
            overrideBtn.textContent = 'Substituir';
            overrideBtn.setAttribute('aria-label', `Substituir comando: ${it.cmd}`);
            overrideBtn.onclick = (e) => {
                e.stopPropagation();
                prefillAddForm(it); // Chama a nova função
            };
            right.appendChild(overrideBtn);
        }

        const copyBtn = document.createElement('button');
        copyBtn.className = 'btncopy';
        copyBtn.textContent = 'Copiar';
        copyBtn.setAttribute('aria-label', `Copiar comando: ${it.cmd}`);
        copyBtn.onclick = (e) => {
            e.stopPropagation();
            copyCommand(it.cmd);
        };
        right.appendChild(copyBtn);

        card.appendChild(left);
        card.appendChild(right);
        
        // Adiciona destaque de pesquisa (se aplicável)
        const term = qEl.value.trim().toLowerCase();
        if (term.length >= 3 && (it.cmd.toLowerCase().includes(term) || it.desc.toLowerCase().includes(term))) {
            card.classList.add('highlight-search');
        }

        return card;
    }

    /**
     * Renderiza a lista de comandos (árvore)
     * (*** LÓGICA DE DESTAQUE MOVIDA PARA DENTRO DE renderCard ***)
     */
    function renderList(filterText = "") {
        resultsEl.innerHTML = "";
        const term = filterText.trim().toLowerCase();
        const useSearch = term.length >= 3;

        // 1. Filtra os comandos pais
        const filtered = commands.filter(item => {
            const inCat = (activeCategory === "Todas") || (item.cat === activeCategory);
            if (!inCat) return false;
            
            if (!useSearch) return true;
            
            // Se a busca bate no PAI
            if (item.cmd.toLowerCase().includes(term) || item.desc.toLowerCase().includes(term)) {
                return true;
            }
            
            // Se a busca bate em algum FILHO
            if (item.sub && item.sub.length > 0) {
                return item.sub.some(subItem => 
                    subItem.cmd.toLowerCase().includes(term) || subItem.desc.toLowerCase().includes(term)
                );
            }
            
            return false;
        });

        filtered.sort((a, b) => a.cmd.localeCompare(b.cmd));

        if (filtered.length === 0) {
            resultsEl.innerHTML = '<div class="small" style="padding:14px;color:var(--muted)">Nenhum comando encontrado.</div>';
            return;
        }

        // 2. Renderiza os itens filtrados
        filtered.forEach(it => {
            
            // Se NÃO tem sub-comandos, renderiza um card simples
            if (!it.sub || it.sub.length === 0) {
                const card = renderCard(it, false);
                resultsEl.appendChild(card);
                return;
            }

            // Se TEM sub-comandos, renderiza como <details> (árvore)
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            
            const parentCard = renderCard(it, false);
            parentCard.classList.add('card-parent');
            
            summary.appendChild(parentCard);
            
            const subList = document.createElement('div');
            subList.className = 'sub-list';

            let isOpen = false;

            // Abre o <details> se a busca bater no PAI ou em algum FILHO
            if (useSearch) {
                const parentMatches = it.cmd.toLowerCase().includes(term) || it.desc.toLowerCase().includes(term);
                const childMatches = it.sub.some(subItem => 
                    subItem.cmd.toLowerCase().includes(term) || subItem.desc.toLowerCase().includes(term)
                );
                
                if (parentMatches || childMatches) {
                    isOpen = true;
                }
            }
            details.open = isOpen;

            // Renderiza sub-itens
            it.sub.forEach(subItem => {
                const subCard = renderCard(subItem, true);
                subList.appendChild(subCard);
            });

            details.appendChild(summary);
            details.appendChild(subList);
            resultsEl.appendChild(details);
        });
    }

    /**
     * Copia o comando e mostra o toast
     */
    function copyCommand(text) {
        if (!text) return;
        navigator.clipboard.writeText(text)
            .then(() => showToast(`Copiado: ${text}`))
            .catch(err => showToast("Erro ao copiar"));
    }

    /**
     * Mostra o toast
     */
    function showToast(msg = "Copiado") {
        toast.textContent = msg;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 2000);
    }

    /**
     * (NOVO) Preenche o formulário de ADIÇÃO para substituir um comando BASE
     */
    function prefillAddForm(baseCommand) {
        newCmdInput.value = baseCommand.cmd;
        newCmdInput.readOnly = true; // Bloqueia o campo 'cmd'
        newCmdInput.focus();
        document.getElementById('new_type').value = baseCommand.type;
        document.getElementById('new_cat').value = baseCommand.cat;
        document.getElementById('new_desc').value = baseCommand.desc;
        
        addBtn.textContent = 'Substituir Comando Base';
        addBtn.style.background = 'var(--accent)';
        cancelOverrideBtn.style.display = 'block';
    }

    /**
     * (NOVO) Limpa o formulário de adição (usado ao cancelar override)
     */
    function clearAddForm(resetOverride = true) {
        addForm.reset();
        if (resetOverride) {
            newCmdInput.readOnly = false;
            addBtn.textContent = 'Adicionar Comando';
            addBtn.style.background = ''; // Volta ao normal
            cancelOverrideBtn.style.display = 'none';
        }
    }

    /**
     * (NOVO) Mostra o modal de edição
     */
    function handleShowEditModal(command) {
        editIdInput.value = command.id; // ID do Firebase
        editCmdInput.value = command.cmd;
        editTypeInput.value = command.type;
        editCatSelect.value = command.cat;
        editDescInput.value = command.desc;
        editModal.style.display = 'flex';
        editCmdInput.focus();
    }

    /**
     * (NOVO) Esconde o modal de edição
     */
    function handleHideEditModal() {
        editModal.style.display = 'none';
        editForm.reset();
    }

    /**
     * (NOVO) Handle de exclusão
     */
    function handleDeleteCommand(command) {
        if (!command.id) return;
        
        const confirmation = confirm(`Tem certeza que deseja excluir o comando:\n\n${command.cmd}\n\nEsta ação não pode ser desfeita.`);
        
        if (confirmation) {
            const commandRef = ref(db, `techkit/commands/${command.id}`);
            remove(commandRef)
                .then(() => {
                    showToast("Comando excluído!");
                    // O onValue() vai recarregar a lista automaticamente
                })
                .catch(err => {
                    console.error("Erro ao excluir:", err);
                    showToast("Erro ao excluir comando.");
                });
        }
    }

    /**
     * (NOVO) Handle do form de Adição/Substituição
     */
    addForm.onsubmit = (e) => {
        e.preventDefault();
        addBtn.disabled = true;
        addBtn.textContent = 'Salvando...';

        const isOverride = newCmdInput.readOnly;
        const cmdKey = newCmdInput.value.trim();

        const newCommand = {
            cmd: cmdKey,
            type: document.getElementById('new_type').value,
            cat: newCatSelect.value,
            desc: document.getElementById('new_desc').value.trim(),
        };

        // Se for override, adicionamos uma flag 'overrides'
        // O 'id' (chave) no Firebase será o próprio comando base
        if (isOverride) {
            newCommand.overrides = cmdKey;
        }

        // Determina a referência do DB
        let dbPushRef;
        if (isOverride) {
            // Se é override, a chave (ID) é o próprio comando base
            dbPushRef = ref(db, `techkit/commands/${cmdKey}`);
        } else {
            // Se é novo, usa push() para ID aleatório
            dbPushRef = push(dbRef); 
        }

        set(dbPushRef, newCommand)
            .then(() => {
                showToast(isOverride ? "Comando substituído!" : "Comando adicionado!");
                clearAddForm(true); // Limpa o form (e o estado de override)
            })
            .catch(err => {
                console.error("Erro ao salvar:", err);
                showToast("Erro ao salvar comando.");
            })
            .finally(() => {
                addBtn.disabled = false;
                // O texto do botão é resetado pelo clearAddForm
            });
    };

    /**
     * (NOVO) Handle do form de Edição
     */
    editForm.onsubmit = (e) => {
        e.preventDefault();
        const id = editIdInput.value;
        if (!id) {
            showToast("Erro: ID do comando não encontrado.");
            return;
        }

        const updatedCommand = {
            cmd: editCmdInput.value.trim(),
            type: editTypeInput.value,
            cat: editCatSelect.value,
            desc: editDescInput.value.trim(),
        };

        // (Importante) Verifica se o comando editado é um 'override'
        // Se for, precisamos manter a flag 'overrides'
        const originalCommand = customCommands.find(c => c.id === id);
        if (originalCommand && originalCommand.overrides) {
            updatedCommand.overrides = originalCommand.overrides;
        }

        const commandRef = ref(db, `techkit/commands/${id}`);
        
        update(commandRef, updatedCommand)
            .then(() => {
                showToast("Comando atualizado!");
                handleHideEditModal();
            })
            .catch(err => {
                console.error("Erro ao atualizar:", err);
                showToast("Erro ao atualizar comando.");
            });
    };

    /**
     * (NOVO) Botão de cancelar override
     */
    cancelOverrideBtn.onclick = () => {
        clearAddForm(true);
    };

    /**
     * (NOVO) Botão de cancelar edição (modal)
     */
    editCancelBtn.onclick = () => {
        handleHideEditModal();
    };


    /**
     * Filtro de pesquisa (input)
     */
    let searchTimeout;
    qEl.oninput = () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            renderList(qEl.value);
        }, 150); // Debounce de 150ms
    };

    /**
     * Limpar pesquisa
     */
    clearBtn.onclick = () => {
        qEl.value = "";
        renderList("");
        qEl.focus();
    };

    /**
     * Filtro de categoria (links da sidebar)
     */
    cats.forEach(c => {
        c.onclick = () => {
            activeCategory = c.dataset.cat;
            cats.forEach(el => el.classList.remove('active'));
            c.classList.add('active');
            renderList(qEl.value);
        };
    });

    /**
     * Popula os <select> de categoria
     */
    function populateCategoryDropdowns() {
        const categories = [
            "Sistema", "Hardware", "Disco & Arquivos", "Rede", 
            "Serviços & Processos", "Usuário & Grupo", "Logs & Diagnóstico",
            "Política & GPO", "Boot & BCD", "PowerShell", "Utilitários GUI",
            "Segurança"
        ].sort();

        // Limpa (caso seja chamado de novo)
        newCatSelect.innerHTML = '';
        editCatSelect.innerHTML = '';
        
        categories.forEach(catName => {
            const option = new Option(catName, catName);
            newCatSelect.add(option.cloneNode(true));
            editCatSelect.add(option.cloneNode(true));
        });
    }

    /**
     * (*** ALTERADO PARA SUPORTAR 'OVERRIDE' ***)
     * Mescla comandos base e comandos customizados (do Firebase)
     * A lógica de 'override' acontece aqui.
     */
    function mergeCommands(base, custom) {
        const mergedMap = new Map();

        // 1. Adiciona todos os comandos base ao Map, usando 'cmd' como chave
        base.forEach(b => {
            mergedMap.set(b.cmd, { ...b }); // Clona o objeto base
        });

        // 2. Itera sobre os comandos customizados
        custom.forEach(c => {
            // A chave é 'overrides' (se existir) ou o 'id' (que é o cmd se for override) ou o 'cmd'
            const key = c.overrides || c.id; 
            
            if (mergedMap.has(key) && c.overrides) {
                // É um OVERRIDE. Substitui o comando base
                // Mantém os sub-comandos do base, se o custom não tiver
                const baseCmd = mergedMap.get(key);
                mergedMap.set(key, { 
                    ...c, // Dados do custom (id, type, desc, cat)
                    sub: (baseCmd && baseCmd.sub) ? baseCmd.sub : null // (Importante) Preserva os sub-itens do base
                }); 
            } else {
                // É um COMANDO NOVO (não é override)
                mergedMap.set(c.cmd, { ...c }); // Adiciona o comando custom
            }
        });

        // Converte o Map de volta para um array
        return Array.from(mergedMap.values());
    }


    /**
     * Ponto de entrada: Ouve o Firebase e renderiza
     */
    onValue(dbRef, (snapshot) => {
        const data = snapshot.val();
        customCommands = [];
        
        if (data) {
            // Transforma o objeto do Firebase (com chaves aleatórias ou chaves=cmd) em array
            customCommands = Object.keys(data).map(key => ({
                id: key, // O 'id' é a chave do Firebase
                ...data[key]
            }));
        }

        // Mescla os comandos base com os do Firebase (com lógica de override)
        commands = mergeCommands(baseCommands, customCommands);
        
        // Renderiza a lista com o filtro/busca atual
        renderList(qEl.value);

    }, (error) => {
        console.error("Erro ao ler dados:", error);
        resultsEl.innerHTML = '<div class="small" style="padding:14px;color:var(--danger)">Erro ao conectar com o Firebase. Verifique a configuração.</div>';
        // Tenta renderizar pelo menos os comandos base
        commands = [...baseCommands];
        renderList(qEl.value);
    });

    // Inicialização
    populateCategoryDropdowns();

</script>
</body>
</html>
